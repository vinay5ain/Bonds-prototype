<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bond Requests - Bonds</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a class="brand" href="index.html">BONDS</a>
      <div class="nav-links">
        <a href="index.html#home">Home</a>
        <a href="index.html#about">About</a>
        <a href="index.html#testimonials">Testimonials</a>
        <a href="index.html#contact">Contact</a>
        <button id="loginBtn" class="btn ghost" style="display:none">Log in</button>
        <button id="registerBtn" class="btn primary" style="display:none">Register</button>
        <button id="profileBtn" class="btn primary">Profile</button>
        <button id="logoutBtn" class="btn ghost">Logout</button>
      </div>
    </div>
  </nav>

  <div class="container" style="padding:32px 20px; max-width:900px;">
    <h2>Incoming Bond Requests</h2>
    <div id="list" class="grid" style="margin-top:14px;"></div>
  </div>

  <script src="app.js"></script>
  <script>
    async function loadRequests() {
      var userId = localStorage.getItem('userId');
      if (!userId) { window.location.href = 'login.html'; return; }
      var res = await fetch('http://localhost:5000/api/bonds/incoming/' + userId);
      var bonds = await res.json();
      var root = document.getElementById('list');
      root.innerHTML = '';
      bonds.forEach(function(b){
        var div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = '<h3>From: ' + (b.fromUser && b.fromUser.username ? b.fromUser.username : 'Unknown') + '</h3>' +
                        '<p class="muted">Requested at: ' + new Date(b.createdAt).toLocaleString() + '</p>' +
                        '<div class="btn-row" style="margin-top:10px;">' +
                        '  <input class="input" type="number" min="1" value="10" style="max-width:120px" id="points-'+b._id+'" />' +
                        '  <button class="btn primary" data-id="'+b._id+'" data-action="accept">Accept</button>' +
                        '  <button class="btn" data-id="'+b._id+'" data-action="reject">Reject</button>' +
                        '</div>';
        root.appendChild(div);
      });
    }
    document.addEventListener('click', async function(e){
      var t = e.target;
      if (t && t.matches('button[data-action]')) {
        var id = t.getAttribute('data-id');
        var action = t.getAttribute('data-action');
        var pointsInput = document.getElementById('points-' + id);
        var points = pointsInput ? Number(pointsInput.value) : undefined;
        var res = await fetch('http://localhost:5000/api/bonds/respond', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ bondId: id, action: action, pointsGranted: points })
        });
        await res.json();
        loadRequests();
      }
    });
    document.addEventListener('DOMContentLoaded', loadRequests);
  </script>
</body>
</html>


